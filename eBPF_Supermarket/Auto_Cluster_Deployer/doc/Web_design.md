## 主机Web 管理平台设计

主机使用 **Rocket** 框架搭建了高效、安全的 Web 管理平台，结合 **Vue.js** 前端框架，为运维人员提供了一个用户友好的操作界面。通过该平台，运维人员可以轻松管理服务器、调度应用软件的部署任务、监控任务执行的实时状态，从而极大提升了系统的自动化运维效率，减少了人为操作带来的风险和复杂度。

该平台采用了 **前后端分离** 的架构设计，前端通过 Vue.js 实现交互页面，后端则由 Rocket 提供 API 服务，配合 **PostgreSQL** 数据库实现数据的持久化和查询。

### 1. 后端接口架构

后端使用 **Rocket** 提供 **RESTful API**，负责处理与服务器、服务器组、部署包和任务相关的操作。各模块功能如下：

```shell
├── auth.rs                     // 处理用户认证相关的逻辑，如注册、登录、修改密码
├── deployment_packages.rs      // 处理部署包的增删改查操作，包括添加、更新、删除和获取部署包
├── deployment_tasks.rs         // 处理部署任务的逻辑，包括创建、获取、更新和删除部署任务
├── main.rs                     // 项目入口，配置和启动 Rocket 应用，挂载各路由和中间件
├── model.rs                    // 定义数据库模型、结构体和数据传输对象（DTO），用于数据存储和交换
├── server_group_members.rs     // 处理服务器组成员的操作，如添加服务器到组、从组中移除服务器等
├── server_groups.rs            // 处理服务器组的增删改查操作，包括创建、更新和删除服务器组
└── servers.rs                  // 处理服务器的增删改查操作，包括添加、删除和获取服务器
```

### 2. 模块功能说明

- **auth.rs**：负责用户的身份认证与权限管理，包括注册、登录和密码修改等操作，使用 **JWT** 进行认证，确保前后端交互安全。
- **deployment_packages.rs**：管理应用软件的部署包，提供增删改查接口，确保系统能有效管理部署包版本及内容。
- **deployment_tasks.rs**：处理部署任务，支持创建、更新、查询和删除操作，能够实时监控任务执行状态。
- **main.rs**：项目入口，负责 Rocket 应用的配置和启动，挂载各路由和中间件，集成全局日志系统。
- **model.rs**：定义数据库模型，使用 **Diesel ORM** 处理数据库操作，确保数据的持久化和高效查询。
- **server_group_members.rs**：管理服务器与服务器组的多对多关系，提供添加和移除操作，确保服务器组管理的灵活性。
- **server_groups.rs**：负责服务器组的增删改查操作，允许运维人员按组管理服务器，支持批量任务分发。
- **servers.rs**：管理服务器的增删改查，维护服务器的基本信息，包括 IP 地址和状态，支持实时监控。

### 3. 前端架构设计

前端使用 **Vue.js** 框架，结合 **Element UI** 组件库，提供响应式的数据绑定和组件化开发模式。通过前端界面，用户可以轻松管理服务器、创建部署任务并监控其执行进度。Vue.js 提供了高效的组件复用能力，确保前端模块结构清晰、易于维护。

**前端文件架构：**

```shell
── src
│   ├── components             // 公共组件目录
│   ├── views                  // 各页面视图组件
│   ├── router                 // 路由管理
│   ├── store                  // 状态管理 (Vuex)
│   └── App.vue                // 根组件
```

主要模块包括：

- **用户认证模块**：
  - 实现用户的登录、注册和密码修改功能，前端使用表单组件与后端 `auth.rs` 接口交互，采用 JWT 令牌机制进行用户认证。
- **服务器管理模块**：
  - 提供服务器列表、服务器状态查看和管理功能，用户可以添加、编辑、删除服务器，前端通过 **Axios** 与 `servers.rs` 接口通信，实时展示服务器的状态。
- **服务器组管理模块**：
  - 支持创建、修改和删除服务器组，允许按组管理服务器集群。前端组件调用 `server_groups.rs` 和 `server_group_members.rs` API 完成服务器组的管理。
- **部署包管理模块**：
  - 允许用户管理应用软件的部署包，包括上传新包、编辑版本、删除旧版本，前端组件通过表单与 `deployment_packages.rs` 进行通信。
- **部署任务管理模块**：
  - 提供部署任务的创建、监控和管理功能，用户可以选择单台服务器或服务器组进行任务分发，实时查看任务的执行进度。前端通过与 `deployment_tasks.rs` 的接口交互，显示任务执行状态。

### 4. 系统架构与技术选型

- **Rocket 框架**：作为后端的 Web 框架，提供高性能、安全性和简洁的路由管理，开发人员能够快速构建 Web 服务并与前端无缝对接。
- **Vue.js 前端**：前端使用 **Vue.js**，通过双向数据绑定和组件化设计，确保系统具有良好的用户体验和高效的数据交互。配合 **Element UI**，提供了丰富的 UI 组件，确保用户界面简洁、易用。
- **Axios 和 RESTful API**：前端通过 **Axios** 向后端发送 HTTP 请求，与 Rocket 的 RESTful API 进行交互。每个模块都有清晰的 API 调用，前后端分离，数据通过 JSON 格式传输。

### 5. 系统优势

- **模块化设计**：前后端采用模块化设计，后端各模块功能独立，前端通过组件复用和状态管理实现模块解耦，确保系统可扩展性和易维护性。
- **高效通信**：通过 **Tonic gRPC** 实现主机与业务服务器的高效异步通信，保证任务的高效分发和执行。前端通过 RESTful API 和 WebSocket 进行数据实时更新。
- **用户友好**：前端界面简洁直观，用户可以轻松完成复杂的任务调度和管理操作，提供实时反馈和操作提示，提升用户体验。
